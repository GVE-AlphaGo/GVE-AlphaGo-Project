{"version":3,"sources":["../src/Certificate.js"],"names":["tbsCertificate","parameters","names","asn1js","Sequence","name","blockName","value","Constructed","optional","idBlock","tagClass","tagNumber","Integer","tbsCertificateVersion","tbsCertificateSerialNumber","AlgorithmIdentifier","schema","signature","RelativeDistinguishedNames","issuer","tbsCertificateValidity","Time","notBefore","utcTimeName","generalTimeName","notAfter","subject","PublicKeyInfo","subjectPublicKeyInfo","Primitive","tbsCertificateIssuerUniqueID","tbsCertificateSubjectUniqueID","Extensions","extensions","Certificate","constructor","tbs","defaultValues","version","serialNumber","issuerUniqueID","subjectUniqueID","signatureAlgorithm","signatureValue","fromSchema","memberName","ArrayBuffer","BitString","Error","asn1","compareSchema","verified","result","valueBeforeDecode","valueBlock","valueDec","valueHex","Array","from","element","Extension","encodeTBS","outputArray","push","toSchema","encodeFlag","tbsSchema","length","fromBER","toJSON","object","byteLength","getPublicKey","subtle","getKeyHash","hashAlgorithm","crypto","Promise","reject","digest","Uint8Array","subjectPublicKey","sign","privateKey","sequence","resolve","engine","then","getSignatureParameters","toBER","signWithPrivateKey","verify","issuerCertificate","isEqual","verifyWithPublicKey"],"mappings":"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","sourcesContent":["import * as asn1js from \"asn1js\";\r\nimport { getParametersValue, bufferToHexCodes, clearProps } from \"pvutils\";\r\nimport { getCrypto, getEngine } from \"./common.js\";\r\nimport AlgorithmIdentifier from \"./AlgorithmIdentifier.js\";\r\nimport RelativeDistinguishedNames from \"./RelativeDistinguishedNames.js\";\r\nimport Time from \"./Time.js\";\r\nimport PublicKeyInfo from \"./PublicKeyInfo.js\";\r\nimport Extension from \"./Extension.js\";\r\nimport Extensions from \"./Extensions.js\";\r\n//**************************************************************************************\r\nfunction tbsCertificate(parameters = {})\r\n{\r\n\t//TBSCertificate  ::=  SEQUENCE  {\r\n\t//    version         [0]  EXPLICIT Version DEFAULT v1,\r\n\t//    serialNumber         CertificateSerialNumber,\r\n\t//    signature            AlgorithmIdentifier,\r\n\t//    issuer               Name,\r\n\t//    validity             Validity,\r\n\t//    subject              Name,\r\n\t//    subjectPublicKeyInfo SubjectPublicKeyInfo,\r\n\t//    issuerUniqueID  [1]  IMPLICIT UniqueIdentifier OPTIONAL,\r\n\t//                         -- If present, version MUST be v2 or v3\r\n\t//    subjectUniqueID [2]  IMPLICIT UniqueIdentifier OPTIONAL,\r\n\t//                         -- If present, version MUST be v2 or v3\r\n\t//    extensions      [3]  EXPLICIT Extensions OPTIONAL\r\n\t//    -- If present, version MUST be v3\r\n\t//}\r\n\t\r\n\t/**\r\n\t * @type {Object}\r\n\t * @property {string} [blockName]\r\n\t * @property {string} [tbsCertificateVersion]\r\n\t * @property {string} [tbsCertificateSerialNumber]\r\n\t * @property {string} [signature]\r\n\t * @property {string} [issuer]\r\n\t * @property {string} [tbsCertificateValidity]\r\n\t * @property {string} [notBefore]\r\n\t * @property {string} [notAfter]\r\n\t * @property {string} [subject]\r\n\t * @property {string} [subjectPublicKeyInfo]\r\n\t * @property {string} [tbsCertificateIssuerUniqueID]\r\n\t * @property {string} [tbsCertificateSubjectUniqueID]\r\n\t * @property {string} [extensions]\r\n\t */\r\n\tconst names = getParametersValue(parameters, \"names\", {});\r\n\t\r\n\treturn (new asn1js.Sequence({\r\n\t\tname: (names.blockName || \"tbsCertificate\"),\r\n\t\tvalue: [\r\n\t\t\tnew asn1js.Constructed({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 0 // [0]\r\n\t\t\t\t},\r\n\t\t\t\tvalue: [\r\n\t\t\t\t\tnew asn1js.Integer({ name: (names.tbsCertificateVersion || \"tbsCertificate.version\") }) // EXPLICIT integer value\r\n\t\t\t\t]\r\n\t\t\t}),\r\n\t\t\tnew asn1js.Integer({ name: (names.tbsCertificateSerialNumber || \"tbsCertificate.serialNumber\") }),\r\n\t\t\tAlgorithmIdentifier.schema(names.signature || {\r\n\t\t\t\tnames: {\r\n\t\t\t\t\tblockName: \"tbsCertificate.signature\"\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tRelativeDistinguishedNames.schema(names.issuer || {\r\n\t\t\t\tnames: {\r\n\t\t\t\t\tblockName: \"tbsCertificate.issuer\"\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tnew asn1js.Sequence({\r\n\t\t\t\tname: (names.tbsCertificateValidity || \"tbsCertificate.validity\"),\r\n\t\t\t\tvalue: [\r\n\t\t\t\t\tTime.schema(names.notBefore || {\r\n\t\t\t\t\t\tnames: {\r\n\t\t\t\t\t\t\tutcTimeName: \"tbsCertificate.notBefore\",\r\n\t\t\t\t\t\t\tgeneralTimeName: \"tbsCertificate.notBefore\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tTime.schema(names.notAfter || {\r\n\t\t\t\t\t\tnames: {\r\n\t\t\t\t\t\t\tutcTimeName: \"tbsCertificate.notAfter\",\r\n\t\t\t\t\t\t\tgeneralTimeName: \"tbsCertificate.notAfter\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t]\r\n\t\t\t}),\r\n\t\t\tRelativeDistinguishedNames.schema(names.subject || {\r\n\t\t\t\tnames: {\r\n\t\t\t\t\tblockName: \"tbsCertificate.subject\"\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tPublicKeyInfo.schema(names.subjectPublicKeyInfo || {\r\n\t\t\t\tnames: {\r\n\t\t\t\t\tblockName: \"tbsCertificate.subjectPublicKeyInfo\"\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tnew asn1js.Primitive({\r\n\t\t\t\tname: (names.tbsCertificateIssuerUniqueID || \"tbsCertificate.issuerUniqueID\"),\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 1 // [1]\r\n\t\t\t\t}\r\n\t\t\t}), // IMPLICIT bistring value\r\n\t\t\tnew asn1js.Primitive({\r\n\t\t\t\tname: (names.tbsCertificateSubjectUniqueID || \"tbsCertificate.subjectUniqueID\"),\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 2 // [2]\r\n\t\t\t\t}\r\n\t\t\t}), // IMPLICIT bistring value\r\n\t\t\tnew asn1js.Constructed({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 3 // [3]\r\n\t\t\t\t},\r\n\t\t\t\tvalue: [Extensions.schema(names.extensions || {\r\n\t\t\t\t\tnames: {\r\n\t\t\t\t\t\tblockName: \"tbsCertificate.extensions\"\r\n\t\t\t\t\t}\r\n\t\t\t\t})]\r\n\t\t\t}) // EXPLICIT SEQUENCE value\r\n\t\t]\r\n\t}));\r\n}\r\n//**************************************************************************************\r\n/**\r\n * Class from RFC5280\r\n */\r\nexport default class Certificate\r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for Certificate class\r\n\t * @param {Object} [parameters={}]\r\n\t * @param {Object} [parameters.schema] asn1js parsed value to initialize the class from\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t//region Internal properties of the object\r\n\t\t/**\r\n\t\t * @type {ArrayBuffer}\r\n\t\t * @desc ToBeSigned (TBS) part of the certificate\r\n\t\t */\r\n\t\tthis.tbs = getParametersValue(parameters, \"tbs\", Certificate.defaultValues(\"tbs\"));\r\n\t\t/**\r\n\t\t * @type {number}\r\n\t\t * @desc Version number\r\n\t\t */\r\n\t\tthis.version = getParametersValue(parameters, \"version\", Certificate.defaultValues(\"version\"));\r\n\t\t/**\r\n\t\t * @type {Integer}\r\n\t\t * @desc Serial number of the certificate\r\n\t\t */\r\n\t\tthis.serialNumber = getParametersValue(parameters, \"serialNumber\", Certificate.defaultValues(\"serialNumber\"));\r\n\t\t/**\r\n\t\t * @type {AlgorithmIdentifier}\r\n\t\t * @desc This field contains the algorithm identifier for the algorithm used by the CA to sign the certificate\r\n\t\t */\r\n\t\tthis.signature = getParametersValue(parameters, \"signature\", Certificate.defaultValues(\"signature\"));\r\n\t\t/**\r\n\t\t * @type {RelativeDistinguishedNames}\r\n\t\t * @desc The issuer field identifies the entity that has signed and issued the certificate\r\n\t\t */\r\n\t\tthis.issuer = getParametersValue(parameters, \"issuer\", Certificate.defaultValues(\"issuer\"));\r\n\t\t/**\r\n\t\t * @type {Time}\r\n\t\t * @desc The date on which the certificate validity period begins\r\n\t\t */\r\n\t\tthis.notBefore = getParametersValue(parameters, \"notBefore\", Certificate.defaultValues(\"notBefore\"));\r\n\t\t/**\r\n\t\t * @type {Time}\r\n\t\t * @desc The date on which the certificate validity period ends\r\n\t\t */\r\n\t\tthis.notAfter = getParametersValue(parameters, \"notAfter\", Certificate.defaultValues(\"notAfter\"));\r\n\t\t/**\r\n\t\t * @type {RelativeDistinguishedNames}\r\n\t\t * @desc The subject field identifies the entity associated with the public key stored in the subject public key field\r\n\t\t */\r\n\t\tthis.subject = getParametersValue(parameters, \"subject\", Certificate.defaultValues(\"subject\"));\r\n\t\t/**\r\n\t\t * @type {PublicKeyInfo}\r\n\t\t * @desc This field is used to carry the public key and identify the algorithm with which the key is used\r\n\t\t */\r\n\t\tthis.subjectPublicKeyInfo = getParametersValue(parameters, \"subjectPublicKeyInfo\", Certificate.defaultValues(\"subjectPublicKeyInfo\"));\r\n\t\t\r\n\t\tif(\"issuerUniqueID\" in parameters)\r\n\t\t\t/**\r\n\t\t\t * @type {ArrayBuffer}\r\n\t\t\t * @desc The subject and issuer unique identifiers are present in the certificate to handle the possibility of reuse of subject and/or issuer names over time\r\n\t\t\t */\r\n\t\t\tthis.issuerUniqueID = getParametersValue(parameters, \"issuerUniqueID\", Certificate.defaultValues(\"issuerUniqueID\"));\r\n\t\t\r\n\t\tif(\"subjectUniqueID\" in parameters)\r\n\t\t\t/**\r\n\t\t\t * @type {ArrayBuffer}\r\n\t\t\t * @desc The subject and issuer unique identifiers are present in the certificate to handle the possibility of reuse of subject and/or issuer names over time\r\n\t\t\t */\r\n\t\t\tthis.subjectUniqueID = getParametersValue(parameters, \"subjectUniqueID\", Certificate.defaultValues(\"subjectUniqueID\"));\r\n\t\t\r\n\t\tif(\"extensions\" in parameters)\r\n\t\t\t/**\r\n\t\t\t * @type {Array}\r\n\t\t\t * @desc If present, this field is a SEQUENCE of one or more certificate extensions\r\n\t\t\t */\r\n\t\t\tthis.extensions = getParametersValue(parameters, \"extensions\", Certificate.defaultValues(\"extensions\"));\r\n\t\t\r\n\t\t/**\r\n\t\t * @type {AlgorithmIdentifier}\r\n\t\t * @desc The signatureAlgorithm field contains the identifier for the cryptographic algorithm used by the CA to sign this certificate\r\n\t\t */\r\n\t\tthis.signatureAlgorithm = getParametersValue(parameters, \"signatureAlgorithm\", Certificate.defaultValues(\"signatureAlgorithm\"));\r\n\t\t/**\r\n\t\t * @type {BitString}\r\n\t\t * @desc The signatureValue field contains a digital signature computed upon the ASN.1 DER encoded tbsCertificate\r\n\t\t */\r\n\t\tthis.signatureValue = getParametersValue(parameters, \"signatureValue\", Certificate.defaultValues(\"signatureValue\"));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region If input argument array contains \"schema\" for this object\r\n\t\tif(\"schema\" in parameters)\r\n\t\t\tthis.fromSchema(parameters.schema);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return default values for all class members\r\n\t * @param {string} memberName String name for a class member\r\n\t */\r\n\tstatic defaultValues(memberName)\r\n\t{\r\n\t\tswitch(memberName)\r\n\t\t{\r\n\t\t\tcase \"tbs\":\r\n\t\t\t\treturn new ArrayBuffer(0);\r\n\t\t\tcase \"version\":\r\n\t\t\t\treturn 0;\r\n\t\t\tcase \"serialNumber\":\r\n\t\t\t\treturn new asn1js.Integer();\r\n\t\t\tcase \"signature\":\r\n\t\t\t\treturn new AlgorithmIdentifier();\r\n\t\t\tcase \"issuer\":\r\n\t\t\t\treturn new RelativeDistinguishedNames();\r\n\t\t\tcase \"notBefore\":\r\n\t\t\t\treturn new Time();\r\n\t\t\tcase \"notAfter\":\r\n\t\t\t\treturn new Time();\r\n\t\t\tcase \"subject\":\r\n\t\t\t\treturn new RelativeDistinguishedNames();\r\n\t\t\tcase \"subjectPublicKeyInfo\":\r\n\t\t\t\treturn new PublicKeyInfo();\r\n\t\t\tcase \"issuerUniqueID\":\r\n\t\t\t\treturn new ArrayBuffer(0);\r\n\t\t\tcase \"subjectUniqueID\":\r\n\t\t\t\treturn new ArrayBuffer(0);\r\n\t\t\tcase \"extensions\":\r\n\t\t\t\treturn [];\r\n\t\t\tcase \"signatureAlgorithm\":\r\n\t\t\t\treturn new AlgorithmIdentifier();\r\n\t\t\tcase \"signatureValue\":\r\n\t\t\t\treturn new asn1js.BitString();\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Invalid member name for Certificate class: ${memberName}`);\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return value of pre-defined ASN.1 schema for current class\r\n\t *\r\n\t * ASN.1 schema:\r\n\t * ```asn1\r\n\t * Certificate  ::=  SEQUENCE  {\r\n\t *    tbsCertificate       TBSCertificate,\r\n\t *    signatureAlgorithm   AlgorithmIdentifier,\r\n\t *    signatureValue       BIT STRING  }\r\n\t * ```\r\n\t *\r\n\t * @param {Object} parameters Input parameters for the schema\r\n\t * @returns {Object} asn1js schema object\r\n\t */\r\n\tstatic schema(parameters = {})\r\n\t{\r\n\t\t/**\r\n\t\t * @type {Object}\r\n\t\t * @property {string} [blockName]\r\n\t\t * @property {string} [tbsCertificate]\r\n\t\t * @property {string} [signatureAlgorithm]\r\n\t\t * @property {string} [signatureValue]\r\n\t\t */\r\n\t\tconst names = getParametersValue(parameters, \"names\", {});\r\n\t\t\r\n\t\treturn (new asn1js.Sequence({\r\n\t\t\tname: (names.blockName || \"\"),\r\n\t\t\tvalue: [\r\n\t\t\t\ttbsCertificate(names.tbsCertificate),\r\n\t\t\t\tAlgorithmIdentifier.schema(names.signatureAlgorithm || {\r\n\t\t\t\t\tnames: {\r\n\t\t\t\t\t\tblockName: \"signatureAlgorithm\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew asn1js.BitString({ name: (names.signatureValue || \"signatureValue\") })\r\n\t\t\t]\r\n\t\t}));\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert parsed asn1js object into current class\r\n\t * @param {!Object} schema\r\n\t */\r\n\tfromSchema(schema)\r\n\t{\r\n\t\t//region Clear input data first\r\n\t\tclearProps(schema, [\r\n\t\t\t\"tbsCertificate\",\r\n\t\t\t\"tbsCertificate.extensions\",\r\n\t\t\t\"tbsCertificate.version\",\r\n\t\t\t\"tbsCertificate.serialNumber\",\r\n\t\t\t\"tbsCertificate.signature\",\r\n\t\t\t\"tbsCertificate.issuer\",\r\n\t\t\t\"tbsCertificate.notBefore\",\r\n\t\t\t\"tbsCertificate.notAfter\",\r\n\t\t\t\"tbsCertificate.subject\",\r\n\t\t\t\"tbsCertificate.subjectPublicKeyInfo\",\r\n\t\t\t\"tbsCertificate.issuerUniqueID\",\r\n\t\t\t\"tbsCertificate.subjectUniqueID\",\r\n\t\t\t\"signatureAlgorithm\",\r\n\t\t\t\"signatureValue\"\r\n\t\t]);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check the schema is valid\r\n\t\tconst asn1 = asn1js.compareSchema(schema,\r\n\t\t\tschema,\r\n\t\t\tCertificate.schema({\r\n\t\t\t\tnames: {\r\n\t\t\t\t\ttbsCertificate: {\r\n\t\t\t\t\t\tnames: {\r\n\t\t\t\t\t\t\textensions: {\r\n\t\t\t\t\t\t\t\tnames: {\r\n\t\t\t\t\t\t\t\t\textensions: \"tbsCertificate.extensions\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t);\r\n\t\t\r\n\t\tif(asn1.verified === false)\r\n\t\t\tthrow new Error(\"Object's schema was not verified against input data for Certificate\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get internal properties from parsed schema\r\n\t\tthis.tbs = asn1.result.tbsCertificate.valueBeforeDecode;\r\n\t\t\r\n\t\tif(\"tbsCertificate.version\" in asn1.result)\r\n\t\t\tthis.version = asn1.result[\"tbsCertificate.version\"].valueBlock.valueDec;\r\n\t\tthis.serialNumber = asn1.result[\"tbsCertificate.serialNumber\"];\r\n\t\tthis.signature = new AlgorithmIdentifier({ schema: asn1.result[\"tbsCertificate.signature\"] });\r\n\t\tthis.issuer = new RelativeDistinguishedNames({ schema: asn1.result[\"tbsCertificate.issuer\"] });\r\n\t\tthis.notBefore = new Time({ schema: asn1.result[\"tbsCertificate.notBefore\"] });\r\n\t\tthis.notAfter = new Time({ schema: asn1.result[\"tbsCertificate.notAfter\"] });\r\n\t\tthis.subject = new RelativeDistinguishedNames({ schema: asn1.result[\"tbsCertificate.subject\"] });\r\n\t\tthis.subjectPublicKeyInfo = new PublicKeyInfo({ schema: asn1.result[\"tbsCertificate.subjectPublicKeyInfo\"] });\r\n\t\tif(\"tbsCertificate.issuerUniqueID\" in asn1.result)\r\n\t\t\tthis.issuerUniqueID = asn1.result[\"tbsCertificate.issuerUniqueID\"].valueBlock.valueHex;\r\n\t\tif(\"tbsCertificate.subjectUniqueID\" in asn1.result)\r\n\t\t\tthis.subjectUniqueID = asn1.result[\"tbsCertificate.subjectUniqueID\"].valueBlock.valueHex;\r\n\t\tif(\"tbsCertificate.extensions\" in asn1.result)\r\n\t\t\tthis.extensions = Array.from(asn1.result[\"tbsCertificate.extensions\"], element => new Extension({ schema: element }));\r\n\t\t\r\n\t\tthis.signatureAlgorithm = new AlgorithmIdentifier({ schema: asn1.result.signatureAlgorithm });\r\n\t\tthis.signatureValue = asn1.result.signatureValue;\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Create ASN.1 schema for existing values of TBS part for the certificate\r\n\t */\r\n\tencodeTBS()\r\n\t{\r\n\t\t//region Create array for output sequence\r\n\t\tconst outputArray = [];\r\n\t\t\r\n\t\tif((\"version\" in this) && (this.version !== Certificate.defaultValues(\"version\")))\r\n\t\t{\r\n\t\t\toutputArray.push(new asn1js.Constructed({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 0 // [0]\r\n\t\t\t\t},\r\n\t\t\t\tvalue: [\r\n\t\t\t\t\tnew asn1js.Integer({ value: this.version }) // EXPLICIT integer value\r\n\t\t\t\t]\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t\toutputArray.push(this.serialNumber);\r\n\t\toutputArray.push(this.signature.toSchema());\r\n\t\toutputArray.push(this.issuer.toSchema());\r\n\t\t\r\n\t\toutputArray.push(new asn1js.Sequence({\r\n\t\t\tvalue: [\r\n\t\t\t\tthis.notBefore.toSchema(),\r\n\t\t\t\tthis.notAfter.toSchema()\r\n\t\t\t]\r\n\t\t}));\r\n\t\t\r\n\t\toutputArray.push(this.subject.toSchema());\r\n\t\toutputArray.push(this.subjectPublicKeyInfo.toSchema());\r\n\t\t\r\n\t\tif(\"issuerUniqueID\" in this)\r\n\t\t{\r\n\t\t\toutputArray.push(new asn1js.Primitive({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 1 // [1]\r\n\t\t\t\t},\r\n\t\t\t\tvalueHex: this.issuerUniqueID\r\n\t\t\t}));\r\n\t\t}\r\n\t\tif(\"subjectUniqueID\" in this)\r\n\t\t{\r\n\t\t\toutputArray.push(new asn1js.Primitive({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 2 // [2]\r\n\t\t\t\t},\r\n\t\t\t\tvalueHex: this.subjectUniqueID\r\n\t\t\t}));\r\n\t\t}\r\n\t\t\r\n\t\tif(\"extensions\" in this)\r\n\t\t{\r\n\t\t\toutputArray.push(new asn1js.Constructed({\r\n\t\t\t\toptional: true,\r\n\t\t\t\tidBlock: {\r\n\t\t\t\t\ttagClass: 3, // CONTEXT-SPECIFIC\r\n\t\t\t\t\ttagNumber: 3 // [3]\r\n\t\t\t\t},\r\n\t\t\t\tvalue: [new asn1js.Sequence({\r\n\t\t\t\t\tvalue: Array.from(this.extensions, element => element.toSchema())\r\n\t\t\t\t})]\r\n\t\t\t}));\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create and return output sequence\r\n\t\treturn (new asn1js.Sequence({\r\n\t\t\tvalue: outputArray\r\n\t\t}));\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert current object to asn1js object and set correct values\r\n\t * @returns {Object} asn1js object\r\n\t */\r\n\ttoSchema(encodeFlag = false)\r\n\t{\r\n\t\tlet tbsSchema = {};\r\n\t\t\r\n\t\t//region Decode stored TBS value\r\n\t\tif(encodeFlag === false)\r\n\t\t{\r\n\t\t\tif(this.tbs.length === 0) // No stored certificate TBS part\r\n\t\t\t\treturn Certificate.schema().value[0];\r\n\t\t\t\r\n\t\t\ttbsSchema = asn1js.fromBER(this.tbs).result;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t//region Create TBS schema via assembling from TBS parts\r\n\t\telse\r\n\t\t\ttbsSchema = this.encodeTBS();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Construct and return new ASN.1 schema for this object\r\n\t\treturn (new asn1js.Sequence({\r\n\t\t\tvalue: [\r\n\t\t\t\ttbsSchema,\r\n\t\t\t\tthis.signatureAlgorithm.toSchema(),\r\n\t\t\t\tthis.signatureValue\r\n\t\t\t]\r\n\t\t}));\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convertion for the class to JSON object\r\n\t * @returns {Object}\r\n\t */\r\n\ttoJSON()\r\n\t{\r\n\t\tconst object = {\r\n\t\t\ttbs: bufferToHexCodes(this.tbs, 0, this.tbs.byteLength),\r\n\t\t\tserialNumber: this.serialNumber.toJSON(),\r\n\t\t\tsignature: this.signature.toJSON(),\r\n\t\t\tissuer: this.issuer.toJSON(),\r\n\t\t\tnotBefore: this.notBefore.toJSON(),\r\n\t\t\tnotAfter: this.notAfter.toJSON(),\r\n\t\t\tsubject: this.subject.toJSON(),\r\n\t\t\tsubjectPublicKeyInfo: this.subjectPublicKeyInfo.toJSON(),\r\n\t\t\tsignatureAlgorithm: this.signatureAlgorithm.toJSON(),\r\n\t\t\tsignatureValue: this.signatureValue.toJSON()\r\n\t\t};\r\n\t\t\r\n\t\tif((\"version\" in this) && (this.version !== Certificate.defaultValues(\"version\")))\r\n\t\t\tobject.version = this.version;\r\n\t\t\r\n\t\tif(\"issuerUniqueID\" in this)\r\n\t\t\tobject.issuerUniqueID = bufferToHexCodes(this.issuerUniqueID, 0, this.issuerUniqueID.byteLength);\r\n\t\t\r\n\t\tif(\"subjectUniqueID\" in this)\r\n\t\t\tobject.subjectUniqueID = bufferToHexCodes(this.subjectUniqueID, 0, this.subjectUniqueID.byteLength);\r\n\t\t\r\n\t\tif(\"extensions\" in this)\r\n\t\t\tobject.extensions = Array.from(this.extensions, element => element.toJSON());\r\n\t\t\r\n\t\treturn object;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Importing public key for current certificate\r\n\t */\r\n\tgetPublicKey(parameters = null)\r\n\t{\r\n\t\treturn getEngine().subtle.getPublicKey(this.subjectPublicKeyInfo, this.signatureAlgorithm, parameters);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Get hash value for subject public key (default SHA-1)\r\n\t * @param {String} [hashAlgorithm=SHA-1] Hashing algorithm name\r\n\t */\r\n\tgetKeyHash(hashAlgorithm = \"SHA-1\")\r\n\t{\r\n\t\t//region Get a \"crypto\" extension\r\n\t\tconst crypto = getCrypto();\r\n\t\tif(typeof crypto === \"undefined\")\r\n\t\t\treturn Promise.reject(\"Unable to create WebCrypto object\");\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn crypto.digest({ name: hashAlgorithm }, new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex));\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Make a signature for current value from TBS section\r\n\t * @param {Object} privateKey Private key for \"subjectPublicKeyInfo\" structure\r\n\t * @param {string} [hashAlgorithm=\"SHA-1\"] Hashing algorithm\r\n\t */\r\n\tsign(privateKey, hashAlgorithm = \"SHA-1\")\r\n\t{\r\n\t\t//region Initial checking\r\n\t\t//region Check private key\r\n\t\tif(typeof privateKey === \"undefined\")\r\n\t\t\treturn Promise.reject(\"Need to provide a private key for signing\");\r\n\t\t//endregion\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet sequence = Promise.resolve();\r\n\t\tlet parameters;\r\n\t\t\r\n\t\tconst engine = getEngine();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get a \"default parameters\" for current algorithm and set correct signature algorithm\r\n\t\tsequence = sequence.then(() => engine.subtle.getSignatureParameters(privateKey, hashAlgorithm));\r\n\t\t\r\n\t\tsequence = sequence.then(result =>\r\n\t\t{\r\n\t\t\tparameters = result.parameters;\r\n\t\t\tthis.signature = result.signatureAlgorithm;\r\n\t\t\tthis.signatureAlgorithm = result.signatureAlgorithm;\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create TBS data for signing\r\n\t\tsequence = sequence.then(() =>\r\n\t\t{\r\n\t\t\tthis.tbs = this.encodeTBS().toBER(false);\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Signing TBS data on provided private key\r\n\t\tsequence = sequence.then(() => engine.subtle.signWithPrivateKey(this.tbs, privateKey, parameters));\r\n\t\t\r\n\t\tsequence = sequence.then(result =>\r\n\t\t{\r\n\t\t\tthis.signatureValue = new asn1js.BitString({ valueHex: result });\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn sequence;\r\n\t}\r\n\t//**********************************************************************************\r\n\tverify(issuerCertificate = null)\r\n\t{\r\n\t\t//region Global variables\r\n\t\tlet subjectPublicKeyInfo = {};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Set correct \"subjectPublicKeyInfo\" value\r\n\t\tif(issuerCertificate !== null)\r\n\t\t\tsubjectPublicKeyInfo = issuerCertificate.subjectPublicKeyInfo;\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(this.issuer.isEqual(this.subject)) // Self-signed certificate\r\n\t\t\t\tsubjectPublicKeyInfo = this.subjectPublicKeyInfo;\r\n\t\t}\r\n\t\t\r\n\t\tif((subjectPublicKeyInfo instanceof PublicKeyInfo) === false)\r\n\t\t\treturn Promise.reject(\"Please provide issuer certificate as a parameter\");\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn getEngine().subtle.verifyWithPublicKey(this.tbs, this.signatureValue, subjectPublicKeyInfo, this.signatureAlgorithm);\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n"],"file":"Certificate.js"}