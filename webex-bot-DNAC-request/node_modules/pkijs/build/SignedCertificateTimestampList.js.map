{"version":3,"sources":["../src/SignedCertificateTimestampList.js"],"names":["SignedCertificateTimestamp","constructor","parameters","version","defaultValues","logID","timestamp","extensions","hashAlgorithm","signatureAlgorithm","signature","fromSchema","schema","fromStream","stream","memberName","ArrayBuffer","Date","asn1js","Any","Error","RawData","seqStream","SeqStream","ByteStream","buffer","data","blockLength","getUint16","getBlock","Uint8Array","slice","extensionsLength","signatureLength","signatureData","asn1","fromBER","offset","result","toSchema","toStream","appendUint16","byteLength","valueBeforeDecode","appendChar","appendView","timeBuffer","timeView","baseArray","valueOf","set","_hashAlgorithm","toLowerCase","_signatureAlgorithm","_signature","toBER","toJSON","verify","logs","dataType","logId","publicKeyBase64","publicKeyInfo","log","log_id","key","PublicKeyInfo","appendUint24","subtle","verifyWithPublicKey","_stream","_buffer","_length","valueBlock","valueHex","algorithmId","SignedCertificateTimestampList","timestamps","compareWithDefault","memberValue","length","names","optional","OctetString","name","blockName","dataLength","push","overallLength","timestampsData","timestampStream","view","Array","from","element","verifySCTsForCertificate","certificate","issuerCertificate","index","parsedValue","tbs","issuerId","preCert","crypto","Promise","reject","i","extnID","splice","encodeTBS","digest","subjectPublicKeyInfo","verifyArray","verifyResult"],"mappings":"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","sourcesContent":["import * as asn1js from \"asn1js\";\r\nimport { getParametersValue, utilFromBase, utilToBase, bufferToHexCodes, toBase64, fromBase64, arrayBufferToString, stringToArrayBuffer } from \"pvutils\";\r\nimport { ByteStream, SeqStream } from \"bytestreamjs\";\r\nimport { getCrypto, getEngine } from \"./common.js\";\r\nimport PublicKeyInfo from \"./PublicKeyInfo.js\";\r\n//**************************************************************************************\r\nexport class SignedCertificateTimestamp\r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for SignedCertificateTimestamp class\r\n\t * @param {Object} [parameters={}]\r\n\t * @param {Object} [parameters.schema] asn1js parsed value to initialize the class from\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t//region Internal properties of the object\r\n\t\t/**\r\n\t\t * @type {number}\r\n\t\t * @desc version\r\n\t\t */\r\n\t\tthis.version = getParametersValue(parameters, \"version\", SignedCertificateTimestamp.defaultValues(\"version\"));\r\n\t\t/**\r\n\t\t * @type {ArrayBuffer}\r\n\t\t * @desc logID\r\n\t\t */\r\n\t\tthis.logID = getParametersValue(parameters, \"logID\", SignedCertificateTimestamp.defaultValues(\"logID\"));\r\n\t\t/**\r\n\t\t * @type {Date}\r\n\t\t * @desc timestamp\r\n\t\t */\r\n\t\tthis.timestamp = getParametersValue(parameters, \"timestamp\", SignedCertificateTimestamp.defaultValues(\"timestamp\"));\r\n\t\t/**\r\n\t\t * @type {ArrayBuffer}\r\n\t\t * @desc extensions\r\n\t\t */\r\n\t\tthis.extensions = getParametersValue(parameters, \"extensions\", SignedCertificateTimestamp.defaultValues(\"extensions\"));\r\n\t\t/**\r\n\t\t * @type {string}\r\n\t\t * @desc hashAlgorithm\r\n\t\t */\r\n\t\tthis.hashAlgorithm = getParametersValue(parameters, \"hashAlgorithm\", SignedCertificateTimestamp.defaultValues(\"hashAlgorithm\"));\r\n\t\t/**\r\n\t\t * @type {string}\r\n\t\t * @desc signatureAlgorithm\r\n\t\t */\r\n\t\tthis.signatureAlgorithm = getParametersValue(parameters, \"signatureAlgorithm\", SignedCertificateTimestamp.defaultValues(\"signatureAlgorithm\"));\r\n\t\t/**\r\n\t\t * @type {Object}\r\n\t\t * @desc signature\r\n\t\t */\r\n\t\tthis.signature = getParametersValue(parameters, \"signature\", SignedCertificateTimestamp.defaultValues(\"signature\"));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region If input argument array contains \"schema\" for this object\r\n\t\tif(\"schema\" in parameters)\r\n\t\t\tthis.fromSchema(parameters.schema);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region If input argument array contains \"stream\"\r\n\t\tif(\"stream\" in parameters)\r\n\t\t\tthis.fromStream(parameters.stream);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return default values for all class members\r\n\t * @param {string} memberName String name for a class member\r\n\t */\r\n\tstatic defaultValues(memberName)\r\n\t{\r\n\t\tswitch(memberName)\r\n\t\t{\r\n\t\t\tcase \"version\":\r\n\t\t\t\treturn 0;\r\n\t\t\tcase \"logID\":\r\n\t\t\tcase \"extensions\":\r\n\t\t\t\treturn new ArrayBuffer(0);\r\n\t\t\tcase \"timestamp\":\r\n\t\t\t\treturn new Date(0);\r\n\t\t\tcase \"hashAlgorithm\":\r\n\t\t\tcase \"signatureAlgorithm\":\r\n\t\t\t\treturn \"\";\r\n\t\t\tcase \"signature\":\r\n\t\t\t\treturn new asn1js.Any();\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Invalid member name for SignedCertificateTimestamp class: ${memberName}`);\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert parsed asn1js object into current class\r\n\t * @param {!Object} schema\r\n\t */\r\n\tfromSchema(schema)\r\n\t{\r\n\t\tif((schema instanceof asn1js.RawData) === false)\r\n\t\t\tthrow new Error(\"Object's schema was not verified against input data for SignedCertificateTimestamp\");\r\n\t\t\r\n\t\tconst seqStream = new SeqStream({\r\n\t\t\tstream: new ByteStream({\r\n\t\t\t\tbuffer: schema.data\r\n\t\t\t})\r\n\t\t});\r\n\t\t\r\n\t\tthis.fromStream(seqStream);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert SeqStream data into current class\r\n\t * @param {!SeqStream} stream\r\n\t */\r\n\tfromStream(stream)\r\n\t{\r\n\t\tconst blockLength = stream.getUint16();\r\n\t\t\r\n\t\tthis.version = (stream.getBlock(1))[0];\r\n\t\t\r\n\t\tif(this.version === 0)\r\n\t\t{\r\n\t\t\tthis.logID = (new Uint8Array(stream.getBlock(32))).buffer.slice(0);\r\n\t\t\tthis.timestamp = new Date(utilFromBase(new Uint8Array(stream.getBlock(8)), 8));\r\n\t\t\t\r\n\t\t\t//region Extensions\r\n\t\t\tconst extensionsLength = stream.getUint16();\r\n\t\t\tthis.extensions = (new Uint8Array(stream.getBlock(extensionsLength))).buffer.slice(0);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Hash algorithm\r\n\t\t\tswitch((stream.getBlock(1))[0])\r\n\t\t\t{\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tthis.hashAlgorithm = \"none\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tthis.hashAlgorithm = \"md5\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tthis.hashAlgorithm = \"sha1\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tthis.hashAlgorithm = \"sha224\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 4:\r\n\t\t\t\t\tthis.hashAlgorithm = \"sha256\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 5:\r\n\t\t\t\t\tthis.hashAlgorithm = \"sha384\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 6:\r\n\t\t\t\t\tthis.hashAlgorithm = \"sha512\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error(\"Object's stream was not correct for SignedCertificateTimestamp\");\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Signature algorithm\r\n\t\t\tswitch((stream.getBlock(1))[0])\r\n\t\t\t{\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tthis.signatureAlgorithm = \"anonymous\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tthis.signatureAlgorithm = \"rsa\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tthis.signatureAlgorithm = \"dsa\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tthis.signatureAlgorithm = \"ecdsa\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error(\"Object's stream was not correct for SignedCertificateTimestamp\");\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Signature\r\n\t\t\tconst signatureLength = stream.getUint16();\r\n\t\t\tconst signatureData = (new Uint8Array(stream.getBlock(signatureLength))).buffer.slice(0);\r\n\t\t\t\r\n\t\t\tconst asn1 = asn1js.fromBER(signatureData);\r\n\t\t\tif(asn1.offset === (-1))\r\n\t\t\t\tthrow new Error(\"Object's stream was not correct for SignedCertificateTimestamp\");\r\n\t\t\t\r\n\t\t\tthis.signature = asn1.result;\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\tif(blockLength !== (47 + extensionsLength + signatureLength))\r\n\t\t\t\tthrow new Error(\"Object's stream was not correct for SignedCertificateTimestamp\");\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert current object to asn1js object and set correct values\r\n\t * @returns {Object} asn1js object\r\n\t */\r\n\ttoSchema()\r\n\t{\r\n\t\tconst stream = this.toStream();\r\n\t\t\r\n\t\treturn new asn1js.RawData({ data: stream.stream.buffer });\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert current object to SeqStream data\r\n\t * @returns {SeqStream} SeqStream object\r\n\t */\r\n\ttoStream()\r\n\t{\r\n\t\tconst stream = new SeqStream();\r\n\t\t\r\n\t\tstream.appendUint16(47 + this.extensions.byteLength + this.signature.valueBeforeDecode.byteLength);\r\n\t\tstream.appendChar(this.version);\r\n\t\tstream.appendView(new Uint8Array(this.logID));\r\n\t\t\r\n\t\tconst timeBuffer = new ArrayBuffer(8);\r\n\t\tconst timeView = new Uint8Array(timeBuffer);\r\n\t\t\r\n\t\tconst baseArray = utilToBase(this.timestamp.valueOf(), 8);\r\n\t\ttimeView.set(new Uint8Array(baseArray), 8 - baseArray.byteLength);\r\n\t\t\r\n\t\tstream.appendView(timeView);\r\n\t\tstream.appendUint16(this.extensions.byteLength);\r\n\t\t\r\n\t\tif(this.extensions.byteLength)\r\n\t\t\tstream.appendView(new Uint8Array(this.extensions));\r\n\t\t\r\n\t\tlet _hashAlgorithm;\r\n\t\t\r\n\t\tswitch(this.hashAlgorithm.toLowerCase())\r\n\t\t{\r\n\t\t\tcase \"none\":\r\n\t\t\t\t_hashAlgorithm = 0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"md5\":\r\n\t\t\t\t_hashAlgorithm = 1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha1\":\r\n\t\t\t\t_hashAlgorithm = 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha224\":\r\n\t\t\t\t_hashAlgorithm = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha256\":\r\n\t\t\t\t_hashAlgorithm = 4;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha384\":\r\n\t\t\t\t_hashAlgorithm = 5;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"sha512\":\r\n\t\t\t\t_hashAlgorithm = 6;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`);\r\n\t\t}\r\n\t\t\r\n\t\tstream.appendChar(_hashAlgorithm);\r\n\t\t\r\n\t\tlet _signatureAlgorithm;\r\n\t\t\r\n\t\tswitch(this.signatureAlgorithm.toLowerCase())\r\n\t\t{\r\n\t\t\tcase \"anonymous\":\r\n\t\t\t\t_signatureAlgorithm = 0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"rsa\":\r\n\t\t\t\t_signatureAlgorithm = 1;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"dsa\":\r\n\t\t\t\t_signatureAlgorithm = 2;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"ecdsa\":\r\n\t\t\t\t_signatureAlgorithm = 3;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`);\r\n\t\t}\r\n\t\t\r\n\t\tstream.appendChar(_signatureAlgorithm);\r\n\t\t\r\n\t\tconst _signature = this.signature.toBER(false);\r\n\t\t\r\n\t\tstream.appendUint16(_signature.byteLength);\r\n\t\tstream.appendView(new Uint8Array(_signature));\r\n\t\t\r\n\t\treturn stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convertion for the class to JSON object\r\n\t * @returns {Object}\r\n\t */\r\n\ttoJSON()\r\n\t{\r\n\t\treturn {\r\n\t\t\tversion: this.version,\r\n\t\t\tlogID: bufferToHexCodes(this.logID),\r\n\t\t\ttimestamp: this.timestamp,\r\n\t\t\textensions: bufferToHexCodes(this.extensions),\r\n\t\t\thashAlgorithm: this.hashAlgorithm,\r\n\t\t\tsignatureAlgorithm: this.signatureAlgorithm,\r\n\t\t\tsignature: this.signature.toJSON()\r\n\t\t};\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Verify SignedCertificateTimestamp for specific input data\r\n\t * @param {Object[]} logs Array of objects with information about each CT Log (like here: https://ct.grahamedgecombe.com/logs.json)\r\n\t * @param {String} logs.log_id Identifier of the CT Log encoded in BASE-64 format\r\n\t * @param {String} logs.key Public key of the CT Log encoded in BASE-64 format\r\n\t * @param {ArrayBuffer} data Data to verify signature against. Could be encoded Certificate or encoded PreCert\r\n\t * @param {Number} [dataType=0] Type = 0 (data is encoded Certificate), type = 1 (data is encoded PreCert)\r\n\t * @return {Promise<void>}\r\n\t */\r\n\tasync verify(logs, data, dataType = 0)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet logId = toBase64(arrayBufferToString(this.logID));\r\n\t\t\r\n\t\tlet publicKeyBase64 = null;\r\n\t\tlet publicKeyInfo;\r\n\t\t\r\n\t\tlet stream = new SeqStream();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Found and init public key\r\n\t\tfor(const log of logs)\r\n\t\t{\r\n\t\t\tif(log.log_id === logId)\r\n\t\t\t{\r\n\t\t\t\tpublicKeyBase64 = log.key;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif(publicKeyBase64 === null)\r\n\t\t\tthrow new Error(`Public key not found for CT with logId: ${logId}`);\r\n\t\t\r\n\t\tconst asn1 = asn1js.fromBER(stringToArrayBuffer(fromBase64(publicKeyBase64)));\r\n\t\tif(asn1.offset === (-1))\r\n\t\t\tthrow new Error(`Incorrect key value for CT Log with logId: ${logId}`);\r\n\t\t\r\n\t\tpublicKeyInfo = new PublicKeyInfo({ schema: asn1.result });\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initialize signed data block\r\n\t\tstream.appendChar(0x00); // sct_version\r\n\t\tstream.appendChar(0x00); // signature_type = certificate_timestamp\r\n\t\t\r\n\t\tconst timeBuffer = new ArrayBuffer(8);\r\n\t\tconst timeView = new Uint8Array(timeBuffer);\r\n\t\t\r\n\t\tconst baseArray = utilToBase(this.timestamp.valueOf(), 8);\r\n\t\ttimeView.set(new Uint8Array(baseArray), 8 - baseArray.byteLength);\r\n\t\t\r\n\t\tstream.appendView(timeView);\r\n\t\t\r\n\t\tstream.appendUint16(dataType);\r\n\t\t\r\n\t\tif(dataType === 0)\r\n\t\t\tstream.appendUint24(data.byteLength);\r\n\t\t\r\n\t\tstream.appendView(new Uint8Array(data));\r\n\t\t\r\n\t\tstream.appendUint16(this.extensions.byteLength);\r\n\t\t\r\n\t\tif(this.extensions.byteLength !== 0)\r\n\t\t\tstream.appendView(new Uint8Array(this.extensions));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Perform verification\r\n\t\treturn getEngine().subtle.verifyWithPublicKey(\r\n\t\t\tstream._stream._buffer.slice(0, stream._length),\r\n\t\t\t{ valueBlock: { valueHex: this.signature.toBER(false) } },\r\n\t\t\tpublicKeyInfo,\r\n\t\t\t{ algorithmId: \"\" },\r\n\t\t\t\"SHA-256\"\r\n\t\t);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n/**\r\n * Class from RFC6962\r\n */\r\nexport default class SignedCertificateTimestampList\r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for SignedCertificateTimestampList class\r\n\t * @param {Object} [parameters={}]\r\n\t * @param {Object} [parameters.schema] asn1js parsed value to initialize the class from\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t//region Internal properties of the object\r\n\t\t/**\r\n\t\t * @type {Array.<SignedCertificateTimestamp>}\r\n\t\t * @desc timestamps\r\n\t\t */\r\n\t\tthis.timestamps = getParametersValue(parameters, \"timestamps\", SignedCertificateTimestampList.defaultValues(\"timestamps\"));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region If input argument array contains \"schema\" for this object\r\n\t\tif(\"schema\" in parameters)\r\n\t\t\tthis.fromSchema(parameters.schema);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return default values for all class members\r\n\t * @param {string} memberName String name for a class member\r\n\t */\r\n\tstatic defaultValues(memberName)\r\n\t{\r\n\t\tswitch(memberName)\r\n\t\t{\r\n\t\t\tcase \"timestamps\":\r\n\t\t\t\treturn [];\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Invalid member name for SignedCertificateTimestampList class: ${memberName}`);\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Compare values with default values for all class members\r\n\t * @param {string} memberName String name for a class member\r\n\t * @param {*} memberValue Value to compare with default value\r\n\t */\r\n\tstatic compareWithDefault(memberName, memberValue)\r\n\t{\r\n\t\tswitch(memberName)\r\n\t\t{\r\n\t\t\tcase \"timestamps\":\r\n\t\t\t\treturn (memberValue.length === 0);\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`Invalid member name for SignedCertificateTimestampList class: ${memberName}`);\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return value of pre-defined ASN.1 schema for current class\r\n\t *\r\n\t * ASN.1 schema:\r\n\t * ```asn1\r\n\t * SignedCertificateTimestampList ::= OCTET STRING\r\n\t * ```\r\n\t *\r\n\t * @param {Object} parameters Input parameters for the schema\r\n\t * @returns {Object} asn1js schema object\r\n\t */\r\n\tstatic schema(parameters = {})\r\n\t{\r\n\t\t/**\r\n\t\t * @type {Object}\r\n\t\t * @property {string} [blockName]\r\n\t\t * @property {string} [optional]\r\n\t\t */\r\n\t\tconst names = getParametersValue(parameters, \"names\", {});\r\n\t\t\r\n\t\tif((\"optional\" in names) === false)\r\n\t\t\tnames.optional = false;\r\n\t\t\r\n\t\treturn (new asn1js.OctetString({\r\n\t\t\tname: (names.blockName || \"SignedCertificateTimestampList\"),\r\n\t\t\toptional: names.optional\r\n\t\t}));\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert parsed asn1js object into current class\r\n\t * @param {!Object} schema\r\n\t */\r\n\tfromSchema(schema)\r\n\t{\r\n\t\t//region Check the schema is valid\r\n\t\tif((schema instanceof asn1js.OctetString) === false)\r\n\t\t\tthrow new Error(\"Object's schema was not verified against input data for SignedCertificateTimestampList\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get internal properties from parsed schema\r\n\t\tconst seqStream = new SeqStream({\r\n\t\t\tstream: new ByteStream({\r\n\t\t\t\tbuffer: schema.valueBlock.valueHex\r\n\t\t\t})\r\n\t\t});\r\n\t\t\r\n\t\tlet dataLength = seqStream.getUint16();\r\n\t\tif(dataLength !== seqStream.length)\r\n\t\t\tthrow new Error(\"Object's schema was not verified against input data for SignedCertificateTimestampList\");\r\n\t\t\r\n\t\twhile(seqStream.length)\r\n\t\t\tthis.timestamps.push(new SignedCertificateTimestamp({ stream: seqStream }));\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convert current object to asn1js object and set correct values\r\n\t * @returns {Object} asn1js object\r\n\t */\r\n\ttoSchema()\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst stream = new SeqStream();\r\n\t\t\r\n\t\tlet overallLength = 0;\r\n\t\t\r\n\t\tconst timestampsData = [];\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get overall length\r\n\t\tfor(const timestamp of this.timestamps)\r\n\t\t{\r\n\t\t\tconst timestampStream = timestamp.toStream();\r\n\t\t\ttimestampsData.push(timestampStream);\r\n\t\t\toverallLength += timestampStream.stream.buffer.byteLength;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\tstream.appendUint16(overallLength);\r\n\t\t\r\n\t\t//region Set data from all timestamps\r\n\t\tfor(const timestamp of timestampsData)\r\n\t\t\tstream.appendView(timestamp.stream.view);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn new asn1js.OctetString({ valueHex: stream.stream.buffer.slice(0) });\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Convertion for the class to JSON object\r\n\t * @returns {Object}\r\n\t */\r\n\ttoJSON()\r\n\t{\r\n\t\treturn {\r\n\t\t\ttimestamps: Array.from(this.timestamps, element => element.toJSON())\r\n\t\t};\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n/**\r\n * Verify SignedCertificateTimestamp for specific certificate content\r\n * @param {Certificate} certificate Certificate for which verification would be performed\r\n * @param {Certificate} issuerCertificate Certificate of the issuer of target certificate\r\n * @param {Object[]} logs Array of objects with information about each CT Log (like here: https://ct.grahamedgecombe.com/logs.json)\r\n * @param {String} logs.log_id Identifier of the CT Log encoded in BASE-64 format\r\n * @param {String} logs.key Public key of the CT Log encoded in BASE-64 format\r\n * @param {Number} [index=-1] Index of SignedCertificateTimestamp inside SignedCertificateTimestampList (for -1 would verify all)\r\n * @return {Array} Array of verification results\r\n */\r\nexport async function verifySCTsForCertificate(certificate, issuerCertificate, logs, index = (-1))\r\n{\r\n\t//region Initial variables\r\n\tlet parsedValue = null;\r\n\tlet tbs;\r\n\tlet issuerId;\r\n\t\r\n\tconst stream = new SeqStream();\r\n\t\r\n\tlet preCert;\r\n\t//endregion\r\n\t\r\n\t//region Get a \"crypto\" extension\r\n\tconst crypto = getCrypto();\r\n\tif(typeof crypto === \"undefined\")\r\n\t\treturn Promise.reject(\"Unable to create WebCrypto object\");\r\n\t//endregion\r\n\t\r\n\t//region Remove certificate extension\r\n\tfor(let i = 0; i < certificate.extensions.length; i++)\r\n\t{\r\n\t\tswitch(certificate.extensions[i].extnID)\r\n\t\t{\r\n\t\t\tcase \"1.3.6.1.4.1.11129.2.4.2\":\r\n\t\t\t\t{\r\n\t\t\t\t\tparsedValue = certificate.extensions[i].parsedValue;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(parsedValue.timestamps.length === 0)\r\n\t\t\t\t\t\tthrow new Error(\"Nothing to verify in the certificate\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tcertificate.extensions.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t}\r\n\t}\r\n\t//endregion\r\n\t\r\n\t//region Check we do have what to verify\r\n\tif(parsedValue === null)\r\n\t\tthrow new Error(\"No SignedCertificateTimestampList extension in the specified certificate\");\r\n\t//endregion\r\n\t\r\n\t//region Prepare modifier TBS value\r\n\ttbs = certificate.encodeTBS().toBER(false);\r\n\t//endregion\r\n\t\r\n\t//region Initialize \"issuer_key_hash\" value\r\n\tissuerId = await crypto.digest({ name: \"SHA-256\" }, new Uint8Array(issuerCertificate.subjectPublicKeyInfo.toSchema().toBER(false)));\r\n\t//endregion\r\n\t\r\n\t//region Make final \"PreCert\" value\r\n\tstream.appendView(new Uint8Array(issuerId));\r\n\tstream.appendUint24(tbs.byteLength);\r\n\tstream.appendView(new Uint8Array(tbs));\r\n\t\r\n\tpreCert = stream._stream._buffer.slice(0, stream._length);\r\n\t//endregion\r\n\t\r\n\t//region Call verification function for specified index\r\n\tif(index === (-1))\r\n\t{\r\n\t\tconst verifyArray = [];\r\n\t\t\r\n\t\tfor(const timestamp of parsedValue.timestamps)\r\n\t\t{\r\n\t\t\tconst verifyResult = await timestamp.verify(logs, preCert, 1);\r\n\t\t\tverifyArray.push(verifyResult);\r\n\t\t}\r\n\t\t\r\n\t\treturn verifyArray;\r\n\t}\r\n\t\r\n\tif(index >= parsedValue.timestamps.length)\r\n\t\tindex = (parsedValue.timestamps.length - 1);\r\n\t\r\n\treturn [await parsedValue.timestamps[index].verify(logs, preCert, 1)];\r\n\t//endregion\r\n}\r\n//**********************************************************************************\r\n"],"file":"SignedCertificateTimestampList.js"}