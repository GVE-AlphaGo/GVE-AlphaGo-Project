{"version":3,"sources":["detect-filetype.js"],"names":["detectFileType","file","logger","type","info","resolve","mimeType","then","mime","lookup","name"],"mappings":";;;;;;;;;;kBAawBA,c;;AATxB;;AACA;;;;;;AAEA;;;;;;AAPA;;;;AAae,SAASA,cAAT,CAAwBC,IAAxB,EAA8BC,MAA9B,EAAsC;AACnD,MAAID,KAAKE,IAAT,EAAe;AACbD,WAAOE,IAAP,4BAAqCH,KAAKE,IAA1C;;AAEA,WAAO,kBAAQE,OAAR,CAAgBJ,KAAKE,IAArB,CAAP;AACD;;AAED,MAAIF,KAAKK,QAAT,EAAmB;AACjBJ,WAAOE,IAAP,gCAAyCH,KAAKE,IAA9C;;AAEA,WAAO,kBAAQE,OAAR,CAAgBJ,KAAKK,QAArB,CAAP;AACD;;AAED;AACA;AACA,SAAO,sBAAOL,IAAP,EACJM,IADI,CACC,UAACJ,IAAD,EAAU;AACd,QAAIA,SAAS,mBAAT,IAAgCA,SAAS,0BAA7C,EAAyE;AACvED,aAAOE,IAAP,8BAAuCD,IAAvC;;AAEA,aAAOK,oBAAKC,MAAL,CAAYR,KAAKS,IAAjB,CAAP;AACD;;AAEDR,WAAOE,IAAP,8BAAuCD,IAAvC;;AAEA,WAAOA,IAAP;AACD,GAXI,CAAP;AAYD","file":"detect-filetype.js","sourcesContent":["/*!\n * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {detect} from '@webex/http-core';\nimport mime from 'mime-types';\n\n/**\n * Determines the file type of the specified file\n * @param {FileLike} file\n * @param {Object} logger\n * @returns {Promise<string>}\n */\nexport default function detectFileType(file, logger) {\n  if (file.type) {\n    logger.info(`file already has type ${file.type}. using existing file.type.`);\n\n    return Promise.resolve(file.type);\n  }\n\n  if (file.mimeType) {\n    logger.info(`file already has mimeType ${file.type}. using existing file.mimeType.`);\n\n    return Promise.resolve(file.mimeType);\n  }\n\n  // This kinda belongs in http core, but since we have no guarantee that\n  // buffers are expected to have names there, it'll stay here for now.\n  return detect(file)\n    .then((type) => {\n      if (type === 'application/x-msi' || type === 'application/octet-stream') {\n        logger.info(`detected filetype to be ${type}. Falling back to mime.lookup`);\n\n        return mime.lookup(file.name);\n      }\n\n      logger.info(`detected filetype to be ${type}. returning it`);\n\n      return type;\n    });\n}\n"]}