{"version":3,"sources":["user-uuid-store.js"],"names":["usersByEmail","usersById","UserUUIDStore","set","user","id","reject","Error","emailAddress","patterns","uuid","test","email","p1","getById","then","u","get","catch","p2","getByEmail","all","ret","resolve"],"mappings":"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","file":"user-uuid-store.js","sourcesContent":["/*!\n * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {patterns} from '@webex/common';\n\nconst usersByEmail = new WeakMap();\nconst usersById = new WeakMap();\n\n/**\n * @class\n */\nexport default class UserUUIDStore {\n  /**\n   * @constructs {UserUUIDStore}\n   */\n  constructor() {\n    usersByEmail.set(this, new Map());\n    usersById.set(this, new Map());\n  }\n\n  /**\n   * Adds a user object to the store\n   * @param {Object} user\n   * @param {string} user.id\n   * @param {string} user.emailAddress\n   * @returns {Promise}\n   */\n  add(user) {\n    if (!user.id) {\n      return Promise.reject(new Error('`user.id` is required'));\n    }\n\n    if (!user.emailAddress) {\n      return Promise.reject(new Error('`user.emailAddress` is required'));\n    }\n\n    if (!patterns.uuid.test(user.id)) {\n      return Promise.reject(new Error('`user.id` does not appear to be a uuid'));\n    }\n\n    if (!patterns.email.test(user.emailAddress)) {\n      return Promise.reject(new Error('`user.emailAddress` does not appear to be an email address'));\n    }\n\n    const p1 = this.getById(user.id)\n      .then((u) => usersById.get(this).set(user.id, Object.assign({}, u, user)))\n      .catch(() => usersById.get(this).set(user.id, Object.assign({}, user)));\n\n    const p2 = this.getByEmail(user.emailAddress)\n      .then((u) => usersByEmail.get(this).set(user.emailAddress, Object.assign({}, u, user)))\n      .catch(() => usersByEmail.get(this).set(user.emailAddress, Object.assign({}, user)));\n\n    return Promise.all([p1, p2]);\n  }\n\n  /**\n   * Retrievves the specified user object from the store\n   * @param {string} id\n   * @returns {Promise<Object>}\n   */\n  get(id) {\n    if (patterns.uuid.test(id)) {\n      return this.getById(id);\n    }\n\n    if (patterns.email.test(id)) {\n      return this.getByEmail(id);\n    }\n\n    return Promise.reject(new Error('`id` does not appear to be a valid user identifier'));\n  }\n\n  /**\n   * Retrieves the specified user object by id from the store\n   * @param {Object} id\n   * @returns {Promise<Object>}\n   */\n  getById(id) {\n    const ret = usersById.get(this).get(id);\n\n    if (ret) {\n      return Promise.resolve(ret);\n    }\n\n    return Promise.reject(new Error('No user found by specified id'));\n  }\n\n\n  /**\n   * Retrieves the specified user object by id from the store\n   * @param {Object} email\n   * @returns {Promise<Object>}\n   */\n  getByEmail(email) {\n    const ret = usersByEmail.get(this).get(email);\n\n    if (ret) {\n      return Promise.resolve(ret);\n    }\n\n    return Promise.reject(new Error('No user found by specified email address'));\n  }\n}\n"]}