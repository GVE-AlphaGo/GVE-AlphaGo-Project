{"version":3,"sources":["analyzer.js"],"names":["StatsAnalyzer","analyze","series","options","analysisKeys","ANALYSIS_STATS","DEFAULT_KEYS","length","ParameterError","properties","analysis","valid","failed","data","forEach","config","property","key","reports","previous","value","index","i","singular","getData","prop","webrtcData","difference","check","ANALYSIS_CHECKS","INCREASING","DECREASING","CONSTANT","push"],"mappings":"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","file":"analyzer.js","sourcesContent":["import {forEach, isFinite, isArray} from 'lodash';\n\nimport {\n  ANALYSIS_STATS,\n  ANALYSIS_CHECKS\n} from '../constants';\nimport ParameterError from '../common/errors/parameter';\n\nconst StatsAnalyzer = {};\n\n/**\n * Can involve changing of the default plugin-meetings sdk for deeper results\n * @param {Array} series of WebRTCData\n * @param {Object} options\n * @param {Array} options.analysisKeys [{key: 'bytesSent', check: 'increasing'}, {key: 'bytesReceived', check: 'increasing'}]\n * @returns {Object} analysis {valid: true/false, failed: { key: [number] }, data: { webRtcKeyToAnalyze: { valid: true/false, reports: [ { value: number, valid: true/false, difference: number } ] } } }\n * @public\n */\nStatsAnalyzer.analyze = (series, options = {analysisKeys: ANALYSIS_STATS.DEFAULT_KEYS}) => {\n  if (!isArray(series) || !series.length || !options || !isArray(options.analysisKeys) || !options.analysisKeys.length) {\n    throw new ParameterError('analyzer->analyze#series must be defined as a nonempty array of WebRTCData objects, and options.analysisKeys must be a nonempty array of strings, representing the properties to analyze.');\n  }\n  const properties = new Set(options.analysisKeys);\n  const analysis = {valid: true, failed: {}, data: {}};\n\n  properties.forEach((config) => {\n    const property = config.key;\n\n    analysis.data[property] = {valid: true, reports: []};\n    analysis.failed[property] = [];\n    let previous = {value: 0};\n    let index = 0;\n\n    for (let i = series.length - 1; i > 0; i -= 1) {\n      const singular = {};\n\n      forEach(series[i].data.getData()[config.prop], (webrtcData) => { // eslint-disable-line\n        const value = webrtcData[property];\n\n        if (!value || !isFinite(value)) {\n          return;\n        }\n        singular.value = value;\n        singular.difference = 0;\n        singular.valid = false;\n        singular.index = index;\n        singular.difference = singular.value - previous.value;\n        if (config.check === ANALYSIS_CHECKS.INCREASING && singular.difference > 0) {\n          singular.valid = true;\n        }\n        else if (config.check === ANALYSIS_CHECKS.DECREASING && singular.difference < 0) {\n          singular.valid = true;\n        }\n        else if (config.check === ANALYSIS_CHECKS.CONSTANT) {\n          singular.valid = true;\n        }\n        else {\n          singular.valid = false;\n        }\n        if (!singular.valid) {\n          analysis.data[property].valid = false;\n          analysis.valid = false;\n          analysis.failed[property].push(i);\n        }\n        previous = singular;\n        analysis.data[property].reports.push(singular);\n      });\n      index += 1;\n    }\n    if (!analysis.data[property].valid) {\n      analysis.valid = false;\n    }\n  });\n\n  return analysis;\n};\n\nexport default StatsAnalyzer;\n"]}