{"version":3,"sources":["request.js"],"names":["MeetingRequest","request","api","API","LOCUS","resource","RESOURCE","LOCI","then","res","determineRedirections","body","catch","error","LoggerProxy","logger","responseBody","remoteLocusClusterUrls","length","all","map","url","method","HTTP_VERBS","GET","runWhitelistedDomains","loci","concat","locusUrls","resolve","StatelessWebexPlugin"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;;;AACA;;;;AAMA;;;IAGqBA,c;;;;;;;;;;;AACnB;;;;wCAIoB;AAAA;;AAClB,aAAO,KAAKC,OAAL,CAAa;AAClBC,aAAKC,eAAIC,KADS;AAElBC,kBAAUC,oBAASC;AAFD,OAAb,EAIJC,IAJI,CAIC,UAACC,GAAD;AAAA,eAAS,OAAKC,qBAAL,CAA2BD,IAAIE,IAA/B,CAAT;AAAA,OAJD,EAKJC,KALI,CAKE,UAACC,KAAD,EAAW;AAChBC,8BAAYC,MAAZ,CAAmBF,KAAnB,sEAA4FA,KAA5F;AACD,OAPI,CAAP;AAQD;;AAED;;AAEA;;;;;;;;0CAKsBG,Y,EAAc;AAAA;;AAClC,UAAIA,aAAaC,sBAAb,IAAuCD,aAAaC,sBAAb,CAAoCC,MAA/E,EAAuF;AACrF,eAAO,kBAAQC,GAAR,CAAYH,aAAaC,sBAAb,CAAoCG,GAApC,CAAwC,UAACC,GAAD;AAAA,iBAAS,OAAKpB,OAAL,CAAa;AAC/EqB,oBAAQC,sBAAWC,GAD4D;AAE/EH,oBAF+E;AAG/EI,mCAAuB,IAHwD,CAGnD;AAHmD,WAAb,EAKjEjB,IALiE,CAK5D,UAACC,GAAD,EAAS;AACbO,yBAAaU,IAAb,GAAoBV,aAAaU,IAAb,CAAkBC,MAAlB,CAAyBlB,IAAIE,IAAJ,CAASe,IAAlC,CAApB;AACAV,yBAAaY,SAAb,GAAyBZ,aAAaY,SAAb,CAAuBD,MAAvB,CAA8BlB,IAAIE,IAAJ,CAASiB,SAAvC,CAAzB;;AAEA,mBAAO,kBAAQC,OAAR,CAAgBb,YAAhB,CAAP;AACD,WAViE,EAWjEJ,KAXiE,CAW3D,UAACC,KAAD,EAAW;AAChBC,kCAAYC,MAAZ,CAAmBF,KAAnB,mFAAyGQ,GAAzG,kBAAyHR,KAAzH;AACD,WAbiE,CAAT;AAAA,SAAxC,CAAZ,EAcJL,IAdI,CAcC;AAAA,iBAAM,kBAAQqB,OAAR,CAAgBb,YAAhB,CAAN;AAAA,SAdD,CAAP;AAeD;;AAED,aAAO,kBAAQa,OAAR,CAAgBb,YAAhB,CAAP;AACD;;;EA3CyCc,+B;;kBAAvB9B,c","file":"request.js","sourcesContent":["import {StatelessWebexPlugin} from '@webex/webex-core';\n\nimport LoggerProxy from '../common/logs/logger-proxy';\nimport {\n  HTTP_VERBS,\n  API,\n  RESOURCE\n} from '../constants';\n\n/**\n * @class MeetingRequest\n */\nexport default class MeetingRequest extends StatelessWebexPlugin {\n  /**\n     *  get all the active meetings for the user\n     * @returns {Array} return locus array\n    */\n  getActiveMeetings() {\n    return this.request({\n      api: API.LOCUS,\n      resource: RESOURCE.LOCI\n    })\n      .then((res) => this.determineRedirections(res.body))\n      .catch((error) => {\n        LoggerProxy.logger.error(`MeetingRequest->getActiveMeetings# failed to get locus details, ${error}`);\n      });\n  }\n\n  // locus federation, determines and populate locus if the responseBody has remote URLs to fetch locus details\n\n  /**\n   *  Fetches indivdual locus rather then getting all at once\n   * @param {object} responseBody determine the locus and fetch them if a remoteUrl is given\n   * @returns {Promise}  returns locusObject array\n   */\n  determineRedirections(responseBody) {\n    if (responseBody.remoteLocusClusterUrls && responseBody.remoteLocusClusterUrls.length) {\n      return Promise.all(responseBody.remoteLocusClusterUrls.map((url) => this.request({\n        method: HTTP_VERBS.GET,\n        url,\n        runWhitelistedDomains: true // allows auth token for whitelisted domain\n      })\n        .then((res) => {\n          responseBody.loci = responseBody.loci.concat(res.body.loci);\n          responseBody.locusUrls = responseBody.locusUrls.concat(res.body.locusUrls);\n\n          return Promise.resolve(responseBody);\n        })\n        .catch((error) => {\n          LoggerProxy.logger.error(`MeetingRequest->determineRedirections# failed to get locus details from url: ${url}, reason: ${error}`);\n        })))\n        .then(() => Promise.resolve(responseBody));\n    }\n\n    return Promise.resolve(responseBody);\n  }\n}\n"]}