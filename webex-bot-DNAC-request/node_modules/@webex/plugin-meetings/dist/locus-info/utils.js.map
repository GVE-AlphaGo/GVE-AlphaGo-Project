{"version":3,"sources":["utils.js"],"names":["ParseUtils","compareLocus","newSequence","currentSequence","newMin","Math","min","rangeStart","entries","newMax","max","rangeEnd","curMin","curMax","newUniqueCurrent","calculateUnique","currentUniqueNew","newHasRange","curHasRange","DELTAEVENT","GT","LT","length","EQ","hasUniqueButInRange","CF","generateSyncDebugFlag","meeting","deltaLocus","baseSequence","workingSequence","locusInfo","sequence","targetSequence","flags","setFlag","LOCUS","SEQUENCE","UN_DEF","isEmptySequence","EMPTY","DEF","toLowerCase","NA","desync","toString","s1","s2","res","forEach","entry","indexOf","push","Object","prototype","hasOwnProperty","call","RANGE_START","RANGE_END","uniqueEntries","minimum","maximum","some"],"mappings":"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","file":"utils.js","sourcesContent":["import {min, max} from 'lodash';\n\nimport {DELTAEVENT, LOCUS} from '../constants';\n\nconst ParseUtils = {};\n\n// https://sqbu-github.cisco.com/WebExSquared/cloud-apps/wiki/Locus-Delta-Events\nParseUtils.compareLocus = (newSequence, currentSequence) => {\n  const newMin = Math.min(newSequence.rangeStart, min(newSequence.entries));\n  const newMax = Math.max(newSequence.rangeEnd, max(newSequence.entries));\n  const curMin = Math.min(currentSequence.rangeStart, min(currentSequence.entries));\n  const curMax = Math.max(currentSequence.rangeEnd, max(currentSequence.entries));\n\n  const newUniqueCurrent = ParseUtils.calculateUnique(newSequence, currentSequence);\n  const currentUniqueNew = ParseUtils.calculateUnique(currentSequence, newSequence);\n\n  const newHasRange = !(newSequence.rangeStart === 0 && newSequence.rangeEnd === 0);\n  const curHasRange = !(currentSequence.rangeStart === 0 && currentSequence.rangeEnd === 0);\n\n  if (newMin > curMax) {\n    return DELTAEVENT.GT;\n  }\n  if (newMax < curMin) {\n    return DELTAEVENT.LT;\n  }\n  if (!newUniqueCurrent.length && !currentUniqueNew.length) {\n    if ((newSequence.rangeEnd - newMin) > (currentSequence.rangeEnd - curMin)) {\n      return DELTAEVENT.GT;\n    }\n    if ((newSequence.rangeEnd - newMin) < (currentSequence.rangeEnd - curMin)) {\n      return DELTAEVENT.LT;\n    }\n\n    return DELTAEVENT.EQ;\n  }\n  if (newUniqueCurrent.length && !currentUniqueNew.length) {\n    return DELTAEVENT.GT;\n  }\n  if (currentUniqueNew.length && !newUniqueCurrent.length) {\n    return DELTAEVENT.LT;\n  }\n\n  if ((!newHasRange && !curHasRange) || ParseUtils.hasUniqueButInRange(newUniqueCurrent, curMin, curMax) ||\n    ParseUtils.hasUniqueButInRange(currentUniqueNew, newMin, newMax)) {\n    return DELTAEVENT.CF;\n  }\n  if (min(newUniqueCurrent) > min(currentUniqueNew)) {\n    return DELTAEVENT.GT;\n  }\n\n  return DELTAEVENT.LT;\n};\n\n\nParseUtils.generateSyncDebugFlag = (meeting, deltaLocus) => {\n  const {baseSequence} = deltaLocus;\n  const workingSequence = meeting.locusInfo.sequence;\n  const targetSequence = deltaLocus.sequence;\n  const flags = ['', '', '', '', '', ''];\n\n  const setFlag = (sequence) => {\n    if (!sequence) {\n      return LOCUS.SEQUENCE.UN_DEF;\n    }\n\n    return (ParseUtils.isEmptySequence(sequence)) ? LOCUS.SEQUENCE.EMPTY : LOCUS.SEQUENCE.DEF;\n  };\n\n  flags[0] = setFlag(baseSequence);\n  flags[1] = setFlag(workingSequence);\n  flags[2] = setFlag(targetSequence);\n\n  flags[3] = (baseSequence && workingSequence) ? ParseUtils.compareLocus(baseSequence, workingSequence).toLowerCase() : LOCUS.SEQUENCE.NA;\n  flags[4] = (workingSequence && targetSequence) ? ParseUtils.compareLocus(workingSequence, targetSequence).toLowerCase() : LOCUS.SEQUENCE.NA;\n  flags[5] = (baseSequence && targetSequence) ? ParseUtils.compareLocus(baseSequence, targetSequence).toLowerCase() : LOCUS.SEQUENCE.NA;\n\n\n  // TODO: check where it is used\n  meeting.desync = flags.toString();\n};\n\nParseUtils.calculateUnique = (s1, s2) => {\n  const res = [];\n\n  s1.entries.forEach((entry) => {\n    /* istanbul ignore else */\n    if ((entry < s2.rangeStart || entry > s2.rangeEnd) && (s2.entries.indexOf(entry) === -1)) {\n      res.push(entry);\n    }\n  });\n\n  return res;\n};\n\n\nParseUtils.isEmptySequence = (sequence) => {\n  if (Object.prototype.hasOwnProperty.call(sequence, LOCUS.SEQUENCE.RANGE_START) && sequence.rangeStart === 0 &&\n    Object.prototype.hasOwnProperty.call(sequence, LOCUS.SEQUENCE.RANGE_END) && sequence.rangeEnd === 0 &&\n    sequence.entries && sequence.entries.length === 0) {\n    return true;\n  }\n\n  return false;\n};\n\nParseUtils.hasUniqueButInRange = (uniqueEntries, minimum, maximum) =>\n  uniqueEntries.some((entry) => ((entry > minimum) && (entry < maximum)));\n\nexport default ParseUtils;\n"]}