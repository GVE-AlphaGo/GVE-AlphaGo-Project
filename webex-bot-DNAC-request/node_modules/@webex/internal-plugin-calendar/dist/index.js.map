{"version":3,"sources":["index.js"],"names":["default","Calendar","config","payloadTransformer","predicates","name","direction","test","ctx","response","resolve","extract","body","items","calendarMeetingExternal","transforms","fn","array","all","map","item","transform","object","encryptionKeyUrl","decryptedParticipants","encryptedParticipants","participant","concat"],"mappings":"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","file":"index.js","sourcesContent":["/*!\n * Copyright (c) 2015-2019 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport '@webex/internal-plugin-device';\nimport '@webex/internal-plugin-encryption';\nimport '@webex/internal-plugin-conversation';\n\nimport {registerInternalPlugin} from '@webex/webex-core';\nimport {has} from 'lodash';\n\nimport Calendar from './calendar';\nimport config from './config';\n\nregisterInternalPlugin('calendar', Calendar, {\n  config,\n  payloadTransformer: {\n    predicates: [\n      {\n        name: 'transformMeetingNotes',\n        direction: 'inbound',\n        test(ctx, response) {\n          return Promise.resolve(has(response, 'body.encryptedNotes'));\n        },\n        extract(response) {\n          return Promise.resolve(response.body);\n        }\n      },\n      {\n        name: 'transformMeetingParticipants',\n        direction: 'inbound',\n        test(ctx, response) {\n          return Promise.resolve(has(response, 'body.encryptedParticipants'));\n        },\n        extract(response) {\n          return Promise.resolve(response.body);\n        }\n      },\n      {\n        name: 'transformMeetingArray',\n        direction: 'inbound',\n        test(ctx, response) {\n          return Promise.resolve(has(response, 'body.items[0].seriesId'));\n        },\n        extract(response) {\n          return Promise.resolve(response.body.items);\n        }\n      },\n      {\n        name: 'transformMeeting',\n        direction: 'inbound',\n        test(ctx, response) {\n          return Promise.resolve(has(response, 'body.seriesId'));\n        },\n        extract(response) {\n          return Promise.resolve(response.body);\n        }\n      },\n      {\n        name: 'transformMeeting',\n        direction: 'inbound',\n        test(ctx, response) {\n          return Promise.resolve(has(response, 'calendarMeetingExternal'));\n        },\n        extract(response) {\n          return Promise.resolve(response.calendarMeetingExternal);\n        }\n      }\n    ],\n    transforms: [\n      {\n        name: 'transformMeetingArray',\n        fn(ctx, array) {\n          return Promise.all(array.map((item) => ctx.transform('transformMeeting', item)));\n        }\n      },\n      {\n        name: 'transformMeeting',\n        direction: 'inbound',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          if (!object.encryptionKeyUrl) {\n            return Promise.resolve();\n          }\n\n          // Decrypt participant properties if meeting object contains participants\n          const decryptedParticipants = object.encryptedParticipants ? object.encryptedParticipants.map((participant) => Promise.all([\n            ctx.transform('decryptTextProp', 'encryptedEmailAddress', object.encryptionKeyUrl, participant),\n            ctx.transform('decryptTextProp', 'encryptedName', object.encryptionKeyUrl, participant)\n          ])) : [];\n\n          return Promise.all([\n            ctx.transform('decryptTextProp', 'encryptedSubject', object.encryptionKeyUrl, object),\n            ctx.transform('decryptTextProp', 'encryptedLocation', object.encryptionKeyUrl, object),\n            ctx.transform('decryptTextProp', 'encryptedNotes', object.encryptionKeyUrl, object),\n            ctx.transform('decryptTextProp', 'webexURI', object.encryptionKeyUrl, object),\n            ctx.transform('decryptTextProp', 'webexURL', object.encryptionKeyUrl, object),\n            ctx.transform('decryptTextProp', 'spaceMeetURL', object.encryptionKeyUrl, object),\n            ctx.transform('decryptTextProp', 'spaceURI', object.encryptionKeyUrl, object),\n            ctx.transform('decryptTextProp', 'spaceURL', object.encryptionKeyUrl, object)\n          ].concat(decryptedParticipants));\n        }\n      },\n      {\n        name: 'transformMeetingNotes',\n        direction: 'inbound',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          if (!object.encryptionKeyUrl) {\n            return Promise.resolve();\n          }\n\n          return Promise.all([\n            ctx.transform('decryptTextProp', 'encryptedNotes', object.encryptionKeyUrl, object)\n          ]);\n        }\n      },\n      {\n        name: 'transformMeetingParticipants',\n        direction: 'inbound',\n        fn(ctx, object) {\n          if (!object) {\n            return Promise.resolve();\n          }\n\n          if (!object.encryptionKeyUrl || !object.encryptedParticipants) {\n            return Promise.resolve();\n          }\n\n          // Decrypt participant properties\n          const decryptedParticipants = object.encryptedParticipants.map((participant) => Promise.all([\n            ctx.transform('decryptTextProp', 'encryptedEmailAddress', object.encryptionKeyUrl, participant),\n            ctx.transform('decryptTextProp', 'encryptedName', object.encryptionKeyUrl, participant)\n          ]));\n\n          return Promise.all(decryptedParticipants);\n        }\n      }\n    ]\n  }\n});\n\nexport {default} from './calendar';\n"]}